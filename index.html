<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>üîß –†–∞–∑–æ–∂–º—ë–º–í—Å—ë ‚Äî proxy browser</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{margin:0;font-family:system-ui;background:#111;color:#eee;display:flex;flex-direction:column;height:100vh}
    header{display:flex;align-items:center;padding:.5rem 1rem;background:#222}
    input{flex:1;padding:.5rem;font-size:1rem;border:none;border-radius:4px}
    button{padding:.5rem 1rem;margin-left:.5rem;font-size:1rem;border:none;border-radius:4px;background:#ffcc00;color:#111;cursor:pointer}
    #viewer{width:100%;flex:1;border:none;background:#fff}
    .foot{padding:.5rem;text-align:center;font-size:.8rem;opacity:.6}
  </style>
</head>
<body>
  <header>
    <input id="url" placeholder="https://any-site.com" autofocus>
    <button id="go">Go</button>
  </header>
  <div id="viewer"></div>
  <div class="foot">–†–∞–±–æ—Ç–∞–µ—Ç 24 / 7</div>

<script>
/* 1. —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker */
if('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');

/* 2. –∫–æ–Ω—Ñ–∏–≥ */
const WORKER = 'https://late-scene-c0e9.mark-toxxter.workers.dev/?url=';

/* 3. –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ SW */
function loadSite(raw){
  const b64 = btoa(raw);
  fetch('/p/' + b64)
    .then(r => r.text())
    .then(html => {
      document.getElementById('viewer').innerHTML = html;
      history.replaceState(null, null, '/p/' + b64);   // –∫—Ä–∞—Å–∏–≤—ã–π URL
    })
    .catch(err => document.getElementById('viewer').innerHTML = '<h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>');
  document.getElementById('url').value = raw;
}

/* 4. –∫–Ω–æ–ø–∫–∞ */
document.getElementById('go').onclick = () => {
  let raw = document.getElementById('url').value.trim();
  if(!raw) return;
  if(!raw.startsWith('http')) raw = 'https://' + raw;
  loadSite(raw);
};

/* 5. –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–æ /p/‚Ä¶ –∏–ª–∏ ?url=‚Ä¶ */
const path = location.pathname;
if(path.startsWith('/p/')){
  try {
    const raw = atob(path.slice(3));
    loadSite(raw);
  } catch(e){}
} else {
  const u = new URLSearchParams(location.search).get('url');
  if(u) loadSite(u);
}
</script>
</body>
</html>
